var nax = {};
nax.savedData = [
  [
    "ammo",
    "655.75",
    "719.0625",
    "Ammo",
    "1"
  ],
  [
    "ammo",
    "1039.9375",
    "817.6875",
    "Ammo",
    "1"
  ],
  [
    "ammo",
    "1114.125",
    "680",
    "Ammo",
    "1"
  ],
  [
    "ammo",
    "1140.125",
    "707.875",
    "Ammo",
    "1"
  ],
  [
    "ammo",
    "968.25",
    "282.1875",
    "Ammo",
    "1"
  ],
  [
    "ammo",
    "768.8125",
    "396.625",
    "Ammo",
    "1"
  ],
  [
    "ammo",
    "428.1875",
    "331.625",
    "Ammo",
    "1"
  ],
  [
    "ammo",
    "547.9375",
    "550.75",
    "Ammo",
    "1"
  ],
  [
    "ammo",
    "430.75",
    "549.375",
    "Ammo",
    "1"
  ],
  [
    "ammo",
    "381.5",
    "814.0625",
    "Ammo",
    "1"
  ],
  [
    "gasStations",
    "1115.75",
    "748.625",
    "Gas Station",
    "1"
  ],
  [
    "gasStations",
    "995.5",
    "910.5",
    "Gas Station",
    "1"
  ],
  [
    "gasStations",
    "925.25",
    "1015.75",
    "Gas Station",
    "1"
  ],
  [
    "gasStations",
    "771.25",
    "1020.5",
    "Gas Station",
    "1"
  ],
  [
    "gasStations",
    "886.125",
    "841.5",
    "Gas Station",
    "1"
  ],
  [
    "gasStations",
    "771.75",
    "1154.25",
    "Gas Station",
    "1"
  ],
  [
    "gasStations",
    "675.125",
    "882.6875",
    "Gas Station",
    "1"
  ],
  [
    "gasStations",
    "929.8125",
    "299.625",
    "Gas Station",
    "1"
  ],
  [
    "gasStations",
    "449.5",
    "464.75",
    "Gas Station",
    "1"
  ],
  [
    "gasStations",
    "512.125",
    "285.75",
    "Gas Station",
    "1"
  ],
  [
    "gasStations",
    "423.875",
    "511.125",
    "Gas Station",
    "1"
  ],
  [
    "gasStations",
    "319.375",
    "743.25",
    "Gas Station",
    "1"
  ],
  [
    "locked",
    "911.625",
    "798.0625",
    "Mawizeh Power Control Substation",
    "1"
  ],
  [
    "locked",
    "830.75",
    "968.5",
    "North Canals Info Booth",
    "1"
  ],
  [
    "locked",
    "873.4375",
    "1055.8125",
    "Ch 7 Editorial Department (take Elevator)",
    "1"
  ],
  [
    "locked",
    "852.5",
    "962.4375",
    "Algae Covered Toolbox",
    "1"
  ],
  [
    "locked",
    "842.125",
    "995.375",
    "Canal Apartment 103",
    "1"
  ],
  [
    "locked",
    "871.375",
    "746.125",
    "Mawizeh Resort Bungalow Room",
    "1"
  ],
  [
    "locked",
    "326.8125",
    "839.625",
    "Al-Safwa Stone Block Office",
    "1"
  ],
  [
    "locked",
    "1118.875",
    "670.8125",
    "Far South Eastern Storage Closet",
    "1"
  ],
  [
    "locked",
    "1064.25",
    "464.625",
    "Airport Maintenance",
    "1"
  ],
  [
    "locked",
    "916.75",
    "244.6875",
    "A.B.F. Antiquities Office",
    "1"
  ],
  [
    "locked",
    "734.375",
    "1168.625",
    "Taraq River Supply Shack",
    "1"
  ],
  [
    "locked",
    "714.9375",
    "1175.1875",
    "Taraq Smuggler's Office",
    "1"
  ],
  [
    "locked",
    "726.4375",
    "537.625",
    "South Zaya Scientist Apartment",
    "1"
  ],
  [
    "locked",
    "718.0625",
    "601.4375",
    "Central Zaya Meeting Room",
    "1"
  ],
  [
    "locked",
    "704.5",
    "320.375",
    "Groundskeepers Building",
    "1"
  ],
  [
    "locked",
    "657.8125",
    "211.1875",
    "Captain's Cache",
    "1"
  ],
  [
    "locked",
    "659.75",
    "210.625",
    "Deckhand's Toolbox (underwater)",
    "1"
  ],
  [
    "locked",
    "496.125",
    "305.875",
    "Sawah Hotel Room 302 & 303",
    "1"
  ],
  [
    "locked",
    "575",
    "414.625",
    "Cemetary Caretaker's Toolbox",
    "1"
  ],
  [
    "locked",
    "585.125",
    "374.125",
    "Caretaker's House",
    "1"
  ],
  [
    "locked",
    "533.4375",
    "368.875",
    "Power Substation Toolbox",
    "1"
  ],
  [
    "locked",
    "920.375",
    "986.75",
    "Yum Yum Burger Back Room",
    "1"
  ],
  [
    "locked",
    "899.25",
    "1077.5",
    "Ch 7 Secure Records Room",
    "1"
  ],
  [
    "locked",
    "1035.9375",
    "779.3125",
    "Under Freeway East Warehouse",
    "1"
  ],
  [
    "locked",
    "1023.9375",
    "469.9375",
    "B.C. Toolbox",
    "1"
  ],
  [
    "locked",
    "1025.0625",
    "442.3125",
    "Traveler's Luggage",
    "1"
  ],
  [
    "locked",
    "956.5625",
    "246.1875",
    "South Al Bagra Top Floor Bedroom",
    "1"
  ],
  [
    "locked",
    "761.5",
    "286.9375",
    "Old Lighthouse Citadel Room",
    "1"
  ],
  [
    "locked",
    "244.5625",
    "520.8125",
    "Longshoreman's Duffel Bag",
    "1"
  ],
  [
    "locked",
    "210.125",
    "567.375",
    "Hafid Ship Bridge Cache",
    "1"
  ],
  [
    "locked",
    "211.5625",
    "566.875",
    "Hafid Ship First Mate Cache",
    "1"
  ],
  [
    "locked",
    "277.9375",
    "884.5625",
    "Quarry Worker's Lost Toolbox (in water)",
    "1"
  ],
  [
    "locked",
    "283.75",
    "906.9375",
    "Crane Control Room",
    "1"
  ],
  [
    "locked",
    "596.375",
    "928.5",
    "Rohan Oil South Guard Shack",
    "1"
  ],
  [
    "locked",
    "536.125",
    "706",
    "Cavern Boat Dock Shack",
    "1"
  ],
  [
    "locked",
    "837.625",
    "762.375",
    "Mawizeh Slum Discarded Cache",
    "1"
  ],
  [
    "locked",
    "451.625",
    "746",
    "Weapons Repair Kit",
    "1"
  ],
  [
    "locked",
    "342.5625",
    "577.875",
    "IHTAQ Warehouse Supply Room",
    "1"
  ],
  [
    "locked",
    "434",
    "531.5",
    "Central Sa'id  Top Floor Apartment",
    "1"
  ],
  [
    "locked",
    "487",
    "464.5",
    "South Bank Apartment",
    "1"
  ],
  [
    "locked",
    "459.9375",
    "317.75",
    "Bank of Adal 2nd Story Office",
    "1"
  ],
  [
    "locked",
    "463.375",
    "316.4375",
    "Bank of Adal Top Story Office",
    "1"
  ],
  [
    "locked",
    "789.9375011672367",
    "399.3750379351941",
    "Clock Repair Tools (top of tower)",
    "1"
  ],
  [
    "locked",
    "666",
    "820.875",
    "Hydro Island Computer",
    "1"
  ],
  [
    "locked",
    "898.4375",
    "250.75",
    "Al Bagra Munitions Storeroom",
    "1"
  ],
  [
    "locked",
    "925.9375",
    "243.1875",
    "Al Bagra Officers Quarters",
    "1"
  ],
  [
    "locked",
    "929.5",
    "257.3125",
    "Al Bagra Barrack",
    "1"
  ],
  [
    "locked",
    "737.533124",
    "644.5",
    "Zaya Radar Dome",
    "1"
  ],
  [
    "locked",
    "759.220624",
    "649.3125",
    "Scientist's Locker (in tunnels)",
    "1"
  ],
  [
    "locked",
    "816.908124",
    "760.6875",
    "Mawizeh Cell Shop",
    "1"
  ],
  [
    "locked",
    "506.25",
    "982.3125",
    "Rohan Control Room Locker (in basement)",
    "1"
  ],
  [
    "locked",
    "531.250000776843",
    "1043.4999783091923",
    "Rohan Oil North Guard Shack",
    "1"
  ],
  [
    "locked",
    "1048.5625",
    "886.625",
    "Police Academy Server Admin",
    "1"
  ],
  [
    "locked",
    "1105",
    "692.125",
    "Ahmed Grocery Store",
    "1"
  ],
  [
    "locked",
    "272.25",
    "787.25",
    "Chemical Storage Warehouse",
    "1"
  ],
  [
    "locked",
    "292.75",
    "517.3125",
    "Special Ops Relay Station",
    "1"
  ],
  [
    "locked",
    "512.3125",
    "547.25",
    "Enfer Back Room",
    "1"
  ],
  [
    "locked",
    "536.375",
    "522.75",
    "Police Armory (2nd floor)",
    "1"
  ],
  [
    "locked",
    "460.875",
    "299.75",
    "Sawah Crypto Mining Farm",
    "1"
  ],
  [
    "locked",
    "453.9375",
    "327.3125",
    "Omar's Auto Repair",
    "1"
  ],
  [
    "locked",
    "540.625",
    "987.5",
    "Rohan Utility Tunnels Locker",
    "1"
  ],
  [
    "locked",
    "440.3125",
    "787.1875",
    "Sattiq Poppy Farmer House",
    "1"
  ],
  [
    "locked",
    "499.875",
    "759",
    "Sattiq Guest Quarters",
    "1"
  ],
  [
    "locked",
    "686.4375",
    "1127.125",
    "Taraq Tunnels Workbench Cache",
    "1"
  ],
  [
    "locked",
    "626.375",
    "806.25",
    "West Zarqwa Safe House",
    "1"
  ],
  [
    "locked",
    "678",
    "806.625",
    "Zarqwa Market Storage",
    "1"
  ],
  [
    "locked",
    "704",
    "812.125",
    "Zarqwa Red Village Apartment (3rd floor)",
    "1"
  ],
  [
    "locked",
    "646.75",
    "207.0625",
    "Thief's Cache",
    "1"
  ],
  [
    "locked",
    "906.6875",
    "748.125",
    "Mawizeh Resort Main Building",
    "1"
  ],
  [
    "locked",
    "938.8125",
    "601.4375",
    "Al Sharim Pass Elders Room (on roof)",
    "1"
  ],
  [
    "locked",
    "954.8125",
    "612.375",
    "Mountaintop Spotter Shack",
    "1"
  ],
  [
    "locked",
    "937.8125",
    "1106.4375",
    "Special Forces Dead Drop",
    "1"
  ],
  [
    "locked",
    "796.5",
    "1059.375",
    "Police Armory (2nd floor)",
    "1"
  ],
  [
    "locked",
    "1043.4375",
    "881.5625",
    "Police Academy Private Locker Room",
    "1"
  ],
  [
    "locked",
    "1027.75",
    "372.8125",
    "Tower Conference Room",
    "1"
  ],
  [
    "locked",
    "1179.125",
    "450.875",
    "Retro Runway Fridge Key",
    "1"
  ],
  [
    "locked",
    "840.9375",
    "873.875",
    "Downtown Post Office Secure Room (take elevator)",
    "1"
  ],
  [
    "locked",
    "496.3125",
    "551.4375",
    "Sa'id Mall Security Room",
    "1"
  ],
  [
    "deaddrops",
    "432.25",
    "939.25",
    "Dead Drop",
    "1"
  ],
  [
    "deaddrops",
    "841.125",
    "943.8125",
    "Dead Drop",
    "1"
  ],
  [
    "deaddrops",
    "836.375",
    "809",
    "Dead Drop",
    "1"
  ],
  [
    "deaddrops",
    "1006.5",
    "595.25",
    "Dead Drop",
    "1"
  ],
  [
    "deaddrops",
    "613.875",
    "432.1875",
    "Dead Drop",
    "1"
  ],
  [
    "deaddrops",
    "530.375",
    "573.4375",
    "Dead Drop",
    "1"
  ]
];


////////////////////////////////////////////////////////////////////////////////

// Get rid of some errors //
var cacheMarkers = [];
var safeMarkers = [];
var weaponMarkers = [];
var armorMarkers = [];
var missionMarkers = [];
var sellMarkers = [];
var airportMarkers = [];
var helipadMarkers = [];
var fortMarkers = [];
var eliteFortMarkers = [];
var deaddropMarkers = [];
var undergroundMarkers = [];
var civilianMarkers = [];
var trapMarkers = [];
var roamingMarkers = [];
var eliteMarkers = [];
var helicopterMarkers = [];
var boatMarkers = [];

hideAll();

// Inject jQuery
var elem = document.createElement("script");
elem.src = "https://code.jquery.com/jquery-3.6.1.min.js";
document.getElementsByTagName("body")[0].appendChild(elem);


function new_checkbox(cbID, array1, array2)
{
	var ptype = nax.typemap[cbID];
	var points = ptype.points;
	var checkBox = document.getElementById(cbID);
	if (checkBox.checked)
	{
		for (var i = 0; i < points.length; i++) 
		{
			points[i].marker = createMarker(points[i], ptype.icon);

			map.addLayer(points[i].marker);
		}
	}
	else
	{
		for (var i = 0; i < points.length; ++i)
		{
			map.removeLayer(points[i].marker);
		}
	}
}

function createMarker(point, typeIcon=null)
{
	if (point.marker != null) return point.marker;

	var lon = point.x;
	var lat = point.y;
	var markerLocation = new L.LatLng(lat, lon);

	var marker;

	var myicon = point.customIcon;
	if (myicon == null)
		myicon = (typeIcon != null ? typeIcon : looseIcon);


	if (myicon != null && point.name.length > 0 && point.count > 1)
		marker = new L.Marker(markerLocation, {icon: myicon}).bindPopup(point.name + "(" + point.count + ")");
	else if (myicon != null && point.name.length > 0)
		marker = new L.Marker(markerLocation, {icon: myicon}).bindPopup(point.name);
	else if (myicon != null)
		marker = new L.Marker(markerLocation, {icon: myicon});
	else
		marker = new L.Marker(markerLocation);

	return marker;
}

function afterJQueryLoad()
{
	nax.typemap = [];
	var addType = function(typename, icon_=null)
	{
		nax.typemap[typename] = {
			name: typename,
			points: [],
			icon: icon_,
		};
	};

	addType("loose", looseIcon);
	addType("caches");
	addType("safes");
	addType("tools", toolIcon);
	addType("filings", filingIcon);
	addType("fridges", fridgeIcon);
	addType("duffles", duffleIcon);
	addType("weapons");
	addType("ammo", ammoIcon);
	addType("armor");
	addType("supplies", supplyIcon);
	addType("meds", medIcon);
	addType("computers", computerIcon);
	addType("lockers", lockerIcon);
	addType("missions");
	addType("towers", towerIcon);
	addType("sells");
	addType("police", policeIcon);
	addType("gasStations", gasIcon);
	addType("airports");
	addType("turrets", turretIcon);
	addType("helipads");
	addType("locations");
	addType("locked", lockedIcon);
	addType("strongholds", strongholdIcon);
	addType("forts");
	addType("eliteForts");
	addType("deaddrops", supplyIcon);
	addType("underground");
	addType("civilians");
	addType("traps");
	addType("roamings");
	addType("elites");
	addType("helicopters");
	addType("cars", carIcon);
	addType("boats");

	nax.tempMarker = null;
	nax.cc = $("#coordinate_clicked");

	nax.form = {};
	nax.form.locX = $('<input type="text" style="display: initial;" value="X"/>');
	nax.form.locY = $('<input type="text" style="display: initial;" value="Y"/>');
	nax.form.name = $('<input type="text" style="display: initial;" placeholder="POI Name"/>');
	nax.form.count= $('<input type="number" style="display: initial;" placeholder="How Many" value="1"/>');
	nax.form.type = $('<select>');

	for (var t in nax.typemap)
	{
		nax.form.type.append( $('<option value="'+t+'">'+t+'</option>') );
	}

	nax.form.add = $('<button type="button">Add Point</button>');
	nax.form.add.on("click", function(){
		// if there's no temp marker, then they haven't clicked a new spot, so leave.
		if (nax.tempMarker == null) return;

		ptype = nax.form.type.val();

		var newPoint = {
			x: nax.form.locX.val(),
			y: nax.form.locY.val(),
			name: nax.form.name.val(),
			count: nax.form.count.val(),
			type: ptype,
			customIcon: null,
			marker: null
		};

		typeData = nax.typemap[ptype];

		typeData.points.push( newPoint );

		newPoint.marker = createMarker(newPoint, typeData.icon);

		map.addLayer(newPoint.marker);

		//remove the temporary marker
		map.removeLayer(nax.tempMarker);
		nax.tempMarker = null;
	});

	nax.form.save = $('<button type="button">Save Data/Code to clipboard</button>');
	nax.form.save.on("click", function(){
		nax.savedData = [];
		for(var type in nax.typemap)
		{
			if (type == "locations") continue; // skip POI locations

			var typeData = nax.typemap[type];
			var points = typeData.points;
			for (var i in points)
			{
				nax.savedData.push([
					type, 
					points[i].x,
					points[i].y,
					points[i].name,
					points[i].count
				]);
			}
		}
		var dataAsStr = JSON.stringify(nax.savedData, null, "  ");

		var realSource = SOURCE;
		realSource = realSource.replaceAll("__BACK" + "TICK__", "`");
		realSource = realSource.replaceAll("__NEW" + "LINE__", String.fromCharCode(92, 110));

		var sauce = 'var nax = {};\n' +
			'nax.savedData = ' + dataAsStr + ';\n' +
			'\n' +
			realSource +
			'\n' +
			'var SOURCE = `' + SOURCE + '`;';

		navigator.clipboard.writeText(sauce);
	});

	nax.form.container = $("<div>");
	nax.form.container
		.append(nax.form.locX)
		.append("<br/>")
		.append(nax.form.locY)
		.append("<br/>")
		.append(nax.form.name)
		.append("<br/>")
		.append(nax.form.count)
		.append("<br/>")
		.append(nax.form.type)
		.append("<br/>")
		.append(nax.form.add)
		.append("<br/>")
		.append("<br/>")
		.append(nax.form.save);

	nax.cc.after(nax.form.container); // append the container after the coordinate clicked span

	map.on('click', function(e){
		nax.form.locX.val(e.latlng.lng);
		nax.form.locY.val(e.latlng.lat);

		// Add a temporary marker
		if (nax.tempMarker != null)
			map.removeLayer(nax.tempMarker);

		var markerLocation = new L.LatLng(e.latlng.lat, e.latlng.lng);

		nax.tempMarker = new L.Marker(markerLocation);

		map.addLayer(nax.tempMarker);
	});

	// Copy POI data
	naxLocations = nax.typemap["locations"].points;
	for (var i in locations)
	{
		naxLocations.push({
			x: locations[i][0],
			y: locations[i][1],
			name: "",
			count: 1,
			type: "locations",
			customIcon: locations[i][2],
			marker: null
		});
	}

	// Copy Stored Data
	for (var i in nax.savedData)
	{
		// data layout: [type, x, y, name, count]
		var data = nax.savedData[i];

		var point = {
			x: data[1],
			y: data[2],
			name: data[3],
			count: data[4],
			type: data[0],
			customIcon: null,
			marker: null
		};

		nax.typemap[point.type].points.push(point);
	}

	checkbox = new_checkbox;
}

setTimeout(afterJQueryLoad, 1000);

////////////////////////////////////////////////////////////////////////////////

var SOURCE = `
////////////////////////////////////////////////////////////////////////////////

// Get rid of some errors //
var cacheMarkers = [];
var safeMarkers = [];
var weaponMarkers = [];
var armorMarkers = [];
var missionMarkers = [];
var sellMarkers = [];
var airportMarkers = [];
var helipadMarkers = [];
var fortMarkers = [];
var eliteFortMarkers = [];
var deaddropMarkers = [];
var undergroundMarkers = [];
var civilianMarkers = [];
var trapMarkers = [];
var roamingMarkers = [];
var eliteMarkers = [];
var helicopterMarkers = [];
var boatMarkers = [];

hideAll();

// Inject jQuery
var elem = document.createElement("script");
elem.src = "https://code.jquery.com/jquery-3.6.1.min.js";
document.getElementsByTagName("body")[0].appendChild(elem);


function new_checkbox(cbID, array1, array2)
{
	var ptype = nax.typemap[cbID];
	var points = ptype.points;
	var checkBox = document.getElementById(cbID);
	if (checkBox.checked)
	{
		for (var i = 0; i < points.length; i++) 
		{
			points[i].marker = createMarker(points[i], ptype.icon);

			map.addLayer(points[i].marker);
		}
	}
	else
	{
		for (var i = 0; i < points.length; ++i)
		{
			map.removeLayer(points[i].marker);
		}
	}
}

function createMarker(point, typeIcon=null)
{
	if (point.marker != null) return point.marker;

	var lon = point.x;
	var lat = point.y;
	var markerLocation = new L.LatLng(lat, lon);

	var marker;

	var myicon = point.customIcon;
	if (myicon == null)
		myicon = (typeIcon != null ? typeIcon : looseIcon);


	if (myicon != null && point.name.length > 0 && point.count > 1)
		marker = new L.Marker(markerLocation, {icon: myicon}).bindPopup(point.name + "(" + point.count + ")");
	else if (myicon != null && point.name.length > 0)
		marker = new L.Marker(markerLocation, {icon: myicon}).bindPopup(point.name);
	else if (myicon != null)
		marker = new L.Marker(markerLocation, {icon: myicon});
	else
		marker = new L.Marker(markerLocation);

	return marker;
}

function afterJQueryLoad()
{
	nax.typemap = [];
	var addType = function(typename, icon_=null)
	{
		nax.typemap[typename] = {
			name: typename,
			points: [],
			icon: icon_,
		};
	};

	addType("loose", looseIcon);
	addType("caches");
	addType("safes");
	addType("tools", toolIcon);
	addType("filings", filingIcon);
	addType("fridges", fridgeIcon);
	addType("duffles", duffleIcon);
	addType("weapons");
	addType("ammo", ammoIcon);
	addType("armor");
	addType("supplies", supplyIcon);
	addType("meds", medIcon);
	addType("computers", computerIcon);
	addType("lockers", lockerIcon);
	addType("missions");
	addType("towers", towerIcon);
	addType("sells");
	addType("police", policeIcon);
	addType("gasStations", gasIcon);
	addType("airports");
	addType("turrets", turretIcon);
	addType("helipads");
	addType("locations");
	addType("locked", lockedIcon);
	addType("strongholds", strongholdIcon);
	addType("forts");
	addType("eliteForts");
	addType("deaddrops", supplyIcon);
	addType("underground");
	addType("civilians");
	addType("traps");
	addType("roamings");
	addType("elites");
	addType("helicopters");
	addType("cars", carIcon);
	addType("boats");

	nax.tempMarker = null;
	nax.cc = $("#coordinate_clicked");

	nax.form = {};
	nax.form.locX = $('<input type="text" style="display: initial;" value="X"/>');
	nax.form.locY = $('<input type="text" style="display: initial;" value="Y"/>');
	nax.form.name = $('<input type="text" style="display: initial;" placeholder="POI Name"/>');
	nax.form.count= $('<input type="number" style="display: initial;" placeholder="How Many" value="1"/>');
	nax.form.type = $('<select>');

	for (var t in nax.typemap)
	{
		nax.form.type.append( $('<option value="'+t+'">'+t+'</option>') );
	}

	nax.form.add = $('<button type="button">Add Point</button>');
	nax.form.add.on("click", function(){
		// if there's no temp marker, then they haven't clicked a new spot, so leave.
		if (nax.tempMarker == null) return;

		ptype = nax.form.type.val();

		var newPoint = {
			x: nax.form.locX.val(),
			y: nax.form.locY.val(),
			name: nax.form.name.val(),
			count: nax.form.count.val(),
			type: ptype,
			customIcon: null,
			marker: null
		};

		typeData = nax.typemap[ptype];

		typeData.points.push( newPoint );

		newPoint.marker = createMarker(newPoint, typeData.icon);

		map.addLayer(newPoint.marker);

		//remove the temporary marker
		map.removeLayer(nax.tempMarker);
		nax.tempMarker = null;
	});

	nax.form.save = $('<button type="button">Save Data/Code to clipboard</button>');
	nax.form.save.on("click", function(){
		nax.savedData = [];
		for(var type in nax.typemap)
		{
			if (type == "locations") continue; // skip POI locations

			var typeData = nax.typemap[type];
			var points = typeData.points;
			for (var i in points)
			{
				nax.savedData.push([
					type, 
					points[i].x,
					points[i].y,
					points[i].name,
					points[i].count
				]);
			}
		}
		var dataAsStr = JSON.stringify(nax.savedData, null, "  ");

		var realSource = SOURCE;
		realSource = realSource.replaceAll("__BACK" + "TICK__", "__BACKTICK__");
		realSource = realSource.replaceAll("__NEW" + "LINE__", String.fromCharCode(92, 110));

		var sauce = 'var nax = {};__NEWLINE__' +
			'nax.savedData = ' + dataAsStr + ';__NEWLINE__' +
			'__NEWLINE__' +
			realSource +
			'__NEWLINE__' +
			'var SOURCE = __BACKTICK__' + SOURCE + '__BACKTICK__;';

		navigator.clipboard.writeText(sauce);
	});

	nax.form.container = $("<div>");
	nax.form.container
		.append(nax.form.locX)
		.append("<br/>")
		.append(nax.form.locY)
		.append("<br/>")
		.append(nax.form.name)
		.append("<br/>")
		.append(nax.form.count)
		.append("<br/>")
		.append(nax.form.type)
		.append("<br/>")
		.append(nax.form.add)
		.append("<br/>")
		.append("<br/>")
		.append(nax.form.save);

	nax.cc.after(nax.form.container); // append the container after the coordinate clicked span

	map.on('click', function(e){
		nax.form.locX.val(e.latlng.lng);
		nax.form.locY.val(e.latlng.lat);

		// Add a temporary marker
		if (nax.tempMarker != null)
			map.removeLayer(nax.tempMarker);

		var markerLocation = new L.LatLng(e.latlng.lat, e.latlng.lng);

		nax.tempMarker = new L.Marker(markerLocation);

		map.addLayer(nax.tempMarker);
	});

	// Copy POI data
	naxLocations = nax.typemap["locations"].points;
	for (var i in locations)
	{
		naxLocations.push({
			x: locations[i][0],
			y: locations[i][1],
			name: "",
			count: 1,
			type: "locations",
			customIcon: locations[i][2],
			marker: null
		});
	}

	// Copy Stored Data
	for (var i in nax.savedData)
	{
		// data layout: [type, x, y, name, count]
		var data = nax.savedData[i];

		var point = {
			x: data[1],
			y: data[2],
			name: data[3],
			count: data[4],
			type: data[0],
			customIcon: null,
			marker: null
		};

		nax.typemap[point.type].points.push(point);
	}

	checkbox = new_checkbox;
}

setTimeout(afterJQueryLoad, 1000);

////////////////////////////////////////////////////////////////////////////////
`;
